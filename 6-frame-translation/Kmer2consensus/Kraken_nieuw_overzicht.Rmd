---
title: "K-meer consensus analyse"
author: "Aranka Steyaert"
date: "20 February 2017"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Kraken

```{r include=FALSE}
tot.reads <- 10000
reads.consensus <- read.csv("Kraken_HiSeq_consensus.csv", header=FALSE)
true.lineages <- read.csv("Kraken_HiSeq_Lineages",fill = TRUE, header=FALSE)
reads.consensus[,ncol(reads.consensus)+1] <- FALSE
for(i in 1:nrow(reads.consensus)){
  if(any(as.character(reads.consensus[i,3])==true.lineages)||as.character(reads.consensus[i,3])=="root"){
    reads.consensus[i,6] <- TRUE
  }else{
    if(reads.consensus[i,5]==0){
      reads.consensus[i,6] <- TRUE
    }else{
      reads.consensus[i,6] <- FALSE
    }
  }
}

colnames(reads.consensus) <- c("Header","taxonID","taxonName","taxonRank","distance","correct")

CLASSES = c("no rank", "superkingdom", "kingdom", "subkingdom", "superphylum", "phylum","subphylum", "superclass", "class", "subclass", "infraclass", "superorder", "order", "suborder","infraorder", "parvorder", "superfamily", "family", "subfamily", "tribe", "subtribe", "genus","subgenus", "species group", "species subgroup", "species", "subspecies", "varietas", "forma")
reads.consensus[,"taxonRank"] <- ordered(reads.consensus[,"taxonRank"], levels = CLASSES)
```

```{r echo=FALSE, fig.width=11}
  barplot(table(reads.consensus[,"correct"],droplevels(reads.consensus[,"taxonRank"])), col=c("red","green"), cex.names = 0.8, main="Voorspellingen volgens taxonrang")
```


```{r echo=FALSE, fig.width=11}
Foute_reads <- reads.consensus[reads.consensus[,"correct"]==FALSE,]
barplot(table(droplevels(Foute_reads[,"taxonRank"])), main="taxonrang van foute classificaties")
barplot(table(Foute_reads[,"distance"]), main="taxonomische afstand tot correcte taxon van foute classificaties")
```

### Precisie en sensitiviteit (genus)

```{r}
voorspellingen <- nrow(reads.consensus)
genera <- sum(reads.consensus[,"taxonRank"]>="genus")
cor.genera <- sum(reads.consensus[reads.consensus[,"taxonRank"]>="genus","correct"]==TRUE)
incor.voorspelling <- sum(reads.consensus[reads.consensus[,"taxonRank"]>="genus","correct"]==FALSE)
precision <- cor.genera/genera
sensitivity <- cor.genera/tot.reads
```

???

$TP = $ alles wat boven genus juist geclassificeerd wordt
$TN = $ ?? (alles zonder classificatie en zonder prote\"ine)
$FP = $ alles wat boven genus fout geclassificeerd wordt
$FN = $ alles wat onder genus geclassificeerd wordt (en wel een prote??ne bevatte)

specificiteit:

* = $\frac{TP}{TP+FP}$
* = $\frac{\#\text{correct voorspelde genera}}{\#\text{voorspelde genera}}$ (Stijn)
* = $\frac{\#\text{correct voorspelde genera}}{\#\text{voorspelde genera} + \#\text{incorrecte voorspellingen boven genus}}$ (Kraken)


sensitiviteit:

* = $\frac{TP}{TP+FN}$
* = $\frac{\#\text{correct voorspelde genera}}{\#\text{reads met gekend genus} + \#\text{incorrecte voorspellingen boven genus}}$ (Stijn)
* = $\frac{\#\text{correct voorspelde genera}}{\#\text{voorspelde genera}}$ (Kraken)

???
 
 .                      | Seed-extend Kmer          |   Stijn (HiSeq zonder filter)
----------------------- | ------------------------  | -------------------------------
Aantal reads            | `r tot.reads`             | 10000
Aantal voorspellingen   | `r voorspellingen`        | 4875
Voorspelde genera       | `r genera`                | 1922
Correcte genera         | `r cor.genera`            | 1501
Incorrecte genera       | `r incor.voorspelling`    | 115
Precisie                | `r precision`             | $73.69\%$
Sensitiviteit           | `r sensitivity`           | $15.01\%$


### Precisie en sensitiviteit (species)

```{r}
species <- sum(reads.consensus[,"taxonRank"]>="species")
cor.species <- sum(reads.consensus[reads.consensus[,"taxonRank"]>="species","correct"]==TRUE)
incor.voorspelling.spec <- sum(reads.consensus[reads.consensus[,"taxonRank"]>="species","correct"]==FALSE)
precision.spec <- cor.species/species
sensitivity.spec <- cor.species/tot.reads
```

 .                      | Seed-extend Kmer            |   Stijn (HiSeq zonder filter)
----------------------- | --------------------------- | -------------------------------
Aantal reads            | `r tot.reads`               | 10000
Aantal voorspellingen   | `r voorspellingen`          | 4875
Voorspelde genera       | `r species`                 | 1922
Correcte genera         | `r cor.species`             | 1501
Incorrecte genera       | `r incor.voorspelling.spec` | 115
Precisie                | `r precision.spec`          | $73.69\%$
Sensitiviteit           | `r sensitivity.spec`        | $15.01\%$